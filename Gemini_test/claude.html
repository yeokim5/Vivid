<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>One More</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Cormorant Garamond", serif;
        background-color: #0a0a0a;
        color: #fff;
        overflow-x: hidden;
        line-height: 1.6;
      }

      .loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #0a0a0a;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        transition: opacity 0.5s ease;
      }

      .loader-text {
        font-size: 24px;
        letter-spacing: 8px;
        animation: pulse 1.5s infinite ease-in-out;
        background: linear-gradient(45deg, #ff6b6b, #f3a183, #8a2be2);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
      }

      @keyframes pulse {
        0% {
          opacity: 0.3;
          transform: scale(0.98);
        }
        50% {
          opacity: 1;
          transform: scale(1.02);
        }
        100% {
          opacity: 0.3;
          transform: scale(0.98);
        }
      }

      .main-container {
        position: relative;
      }

      .section {
        height: 100vh;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
      }

      .text-container {
        max-width: 800px;
        width: 90%;
        position: relative;
        padding: 2rem;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 15px;
        backdrop-filter: blur(5px);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 10;
      }

      .text-block {
        margin-bottom: 2rem;
        opacity: 0;
        font-size: 28px;
        position: relative;
        transition: opacity 0.5s ease;
        text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        font-weight: 300;
        letter-spacing: 1px;
      }

      .outro {
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
      }

      .outro h2 {
        font-size: 4vw;
        opacity: 0;
        letter-spacing: 2px;
        background: linear-gradient(45deg, #ff6b6b, #f3a183, #8a2be2);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
      }

      .particle {
        position: absolute;
        background-color: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        pointer-events: none;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
      }

      #progress-bar {
        position: fixed;
        top: 0;
        left: 0;
        height: 3px;
        background: linear-gradient(to right, #ff6b6b, #f3a183, #8a2be2);
        width: 0%;
        z-index: 100;
        box-shadow: 0 0 10px rgba(255, 107, 107, 0.7);
      }

      .background-image {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        opacity: 0.25;
        z-index: -1;
        filter: saturate(1.2) contrast(1.1);
      }

      .title {
        position: fixed;
        top: 5%;
        left: 5%;
        font-size: 18px;
        font-weight: 300;
        letter-spacing: 4px;
        z-index: 50;
        background: linear-gradient(45deg, #ff6b6b, #f3a183, #8a2be2);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
      }

      .footer {
        position: fixed;
        bottom: 5%;
        right: 5%;
        font-size: 14px;
        letter-spacing: 2px;
        z-index: 50;
        opacity: 0.7;
        animation: glow 2s infinite alternate;
      }

      @keyframes glow {
        from {
          text-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
        }
        to {
          text-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
        }
      }

      /* Add animated background */
      .animated-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(125deg, #000000, #1a0033, #000033, #000000);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
        z-index: -2;
      }

      @keyframes gradientBG {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* 3D scene container */
      #scene-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <!-- Three.js library -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>
  </head>
  <body>
    <div class="loader">
      <div class="loader-text">ONE MORE</div>
    </div>

    <div id="progress-bar"></div>
    <div class="animated-bg"></div>
    <div id="scene-container"></div>
    <div class="title">ONE MORE</div>
    <div class="footer">SCROLL TO CONTINUE</div>

    <div class="main-container">
      <section class="section intro" data-scene="kiss">
        <div class="text-container">
          <div class="text-block" data-scroll>
            Do you think I can have one more kiss?
          </div>
          <div class="text-block" data-scroll>
            I'll find closure on your lips, and then I'll go.
          </div>
        </div>
      </section>

      <section class="section" data-scene="meals">
        <div class="text-container">
          <div class="text-block" data-scroll>
            Maybe also one more breakfast, one more lunch, and one more dinner.
          </div>
          <div class="text-block" data-scroll>
            I'll be full and happy and we can part.
          </div>
        </div>
      </section>

      <section class="section" data-scene="bed">
        <div class="text-container">
          <div class="text-block" data-scroll>
            But in between meals, maybe we can lie in bed one more time.
          </div>
          <div class="text-block" data-scroll>
            One more prolonged moment where time suspends indefinitely as I rest
            my head on your chest.
          </div>
        </div>
      </section>

      <section class="section" data-scene="lifetime">
        <div class="text-container">
          <div class="text-block" data-scroll>
            My hope is if we add up the 'one mores,' they will equal a lifetime
            and I'll never have to get to the part where I let you go.
          </div>
          <div class="text-block" data-scroll>But that's not real, is it?</div>
        </div>
      </section>

      <section class="section" data-scene="no-more">
        <div class="text-container">
          <div class="text-block" data-scroll>
            There are no more 'one mores.'
          </div>
        </div>
      </section>

      <section class="section" data-scene="new-exciting">
        <div class="text-container">
          <div class="text-block" data-scroll>
            I met you when everything was new and exciting, and the
            possibilities of the world seemed endless.
          </div>
          <div class="text-block" data-scroll>
            And they still are... for you, for me, but not for us.
          </div>
        </div>
      </section>

      <section class="section" data-scene="grew-up">
        <div class="text-container">
          <div class="text-block" data-scroll>
            Somewhere between then and now, here and there, I guess we didn't
            just grow apart, we grew up.
          </div>
        </div>
      </section>

      <section class="section" data-scene="shatter">
        <div class="text-container">
          <div class="text-block" data-scroll>
            When something breaks, if the pieces are large enough, you can fix
            it.
          </div>
          <div class="text-block" data-scroll>
            Unfortunately, sometimes things don't break, they shatter.
          </div>
        </div>
      </section>

      <section class="section" data-scene="glitter">
        <div class="text-container">
          <div class="text-block" data-scroll>
            But when you let the light in, shattered glass will glitter.
          </div>
        </div>
      </section>

      <section class="section" data-scene="beautiful">
        <div class="text-container">
          <div class="text-block" data-scroll>
            And in those moments when the pieces of what we were catch the sun,
            I'll remember just how beautiful it was.
          </div>
          <div class="text-block" data-scroll>
            Just how beautiful it'll always be.
          </div>
        </div>
      </section>

      <section class="section outro" data-scene="magic">
        <h2 class="text-block" data-scroll>
          Because it was us. And we were magic. Forever.
        </h2>
      </section>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollSmoother.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/SplitText.min.js"></script>
    <script src="scenes.js"></script>
    <script>
      // Initialize GSAP plugins
      try {
        gsap.registerPlugin(ScrollTrigger);
        console.log("ScrollTrigger plugin registered");

        // Check if ScrollSmoother is available
        if (typeof ScrollSmoother !== "undefined") {
          gsap.registerPlugin(ScrollSmoother);
          console.log("ScrollSmoother plugin registered");
        } else {
          console.warn("ScrollSmoother plugin not available");
        }

        // Check if SplitText is available (it's a Club GreenSock membership plugin)
        if (typeof SplitText !== "undefined") {
          gsap.registerPlugin(SplitText);
          console.log("SplitText plugin registered");
        } else {
          console.warn(
            "SplitText plugin not available - using fallback animation"
          );
        }
      } catch (error) {
        console.error("Error registering GSAP plugins:", error);
      }

      // Wait for all resources to load
      window.addEventListener("load", function () {
        // Make sure Three.js and all required modules are loaded
        if (typeof THREE === "undefined") {
          console.error("Three.js not loaded");
          document.body.innerHTML +=
            '<div style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.8); padding:20px; z-index:9999;">Error: Three.js not loaded</div>';
          return;
        }

        // Check for required Three.js objects
        if (!THREE.WebGLRenderer || !THREE.PerspectiveCamera || !THREE.Scene) {
          console.error("Required Three.js objects not available");
          document.body.innerHTML +=
            '<div style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.8); padding:20px; z-index:9999;">Error: Three.js components missing</div>';
          return;
        }

        // Hide loader
        try {
          gsap.to(".loader", {
            opacity: 0,
            duration: 1,
            onComplete: () => {
              document.querySelector(".loader").style.display = "none";
              try {
                init();
                console.log("Initialization completed");
              } catch (error) {
                console.error("Error during initialization:", error);
                document.body.innerHTML +=
                  '<div style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.8); padding:20px; z-index:9999;">Error: ' +
                  error.message +
                  "</div>";
                // Fallback to show all text if GSAP fails
                showAllTextFallback();
              }
            },
          });
        } catch (error) {
          console.error("Error hiding loader:", error);
          document.querySelector(".loader").style.display = "none";
          // Fallback to show all text if GSAP fails
          showAllTextFallback();
        }
      });

      // Fallback function to show all text if GSAP fails
      function showAllTextFallback() {
        console.log("Using fallback to show all text");
        document.querySelectorAll(".text-block").forEach((block) => {
          block.style.opacity = "1";
        });
        document.querySelector(".outro h2").style.opacity = "1";
      }

      function init() {
        // Create smooth scrolling experience
        try {
          if (typeof ScrollSmoother !== "undefined") {
            const smoother = ScrollSmoother.create({
              smooth: 1.5,
              effects: true,
              normalizeScroll: true,
            });
          }
        } catch (error) {
          console.warn("ScrollSmoother not available:", error);
        }

        // Create progress bar animation
        gsap.to("#progress-bar", {
          width: "100%",
          ease: "none",
          scrollTrigger: {
            trigger: ".main-container",
            start: "top top",
            end: "bottom bottom",
            scrub: 0.3,
          },
        });

        // Create 3D scene transitions on scroll
        setupSceneTransitions();

        // Create text block animations
        const textBlocks = document.querySelectorAll(".text-block");
        textBlocks.forEach((block) => {
          // Always make text blocks visible on scroll, regardless of plugin availability
          gsap.to(block, {
            opacity: 1,
            duration: 0.8,
            scrollTrigger: {
              trigger: block,
              start: "top 80%",
              toggleActions: "play none none reverse",
            },
          });

          // Animation with or without SplitText
          if (typeof SplitText !== "undefined") {
            // Split text for character-by-character animation
            try {
              const splitText = new SplitText(block, { type: "chars, words" });
              gsap.from(splitText.chars, {
                opacity: 0,
                y: 50,
                rotationX: -90,
                stagger: 0.02,
                duration: 1,
                ease: "power3.out",
                scrollTrigger: {
                  trigger: block,
                  start: "top 80%",
                  end: "top 20%",
                  toggleActions: "play none none reverse",
                },
              });
            } catch (error) {
              console.warn("Error with SplitText:", error);
            }
          } else {
            // Fallback animation without SplitText
            gsap.from(block, {
              y: 30,
              duration: 1,
              ease: "power3.out",
              scrollTrigger: {
                trigger: block,
                start: "top 80%",
                end: "top 20%",
                toggleActions: "play none none reverse",
              },
            });
          }
        });

        // Outro animation
        gsap.to(".outro h2", {
          opacity: 1,
          duration: 2,
          scrollTrigger: {
            trigger: ".outro",
            start: "top 50%",
            end: "bottom bottom",
            scrub: 1,
          },
        });

        // Add shattered glass effect for the special section
        const shatterSection = document.querySelector(".section:nth-child(9)");

        for (let i = 0; i < 50; i++) {
          const particle = document.createElement("div");
          particle.classList.add("particle");

          // Random size between 5px and 15px
          const size = Math.random() * 10 + 5;
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;

          // Random position within the section
          particle.style.top = `${Math.random() * 100}%`;
          particle.style.left = `${Math.random() * 100}%`;

          shatterSection.appendChild(particle);

          // Animate particles
          gsap.to(particle, {
            opacity: Math.random() * 0.8 + 0.2,
            x: Math.random() * 100 - 50,
            y: Math.random() * 100 - 50,
            duration: Math.random() * 3 + 2,
            ease: "power2.inOut",
            repeat: -1,
            yoyo: true,
            scrollTrigger: {
              trigger: shatterSection,
              start: "top bottom",
              end: "bottom top",
              toggleActions: "play none none reverse",
            },
          });
        }

        // Footer animation
        gsap.to(".footer", {
          opacity: 0,
          scrollTrigger: {
            trigger: ".main-container",
            start: "top top",
            end: "5% top",
            scrub: true,
          },
        });

        // Create mouse trail effect with colorful particles
        document.addEventListener("mousemove", function (e) {
          const particle = document.createElement("div");
          particle.classList.add("particle");

          // Random size between 2px and 6px
          const size = Math.random() * 4 + 2;
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;

          // Random color
          const colors = [
            "rgba(255,107,107,0.7)",
            "rgba(243,161,131,0.7)",
            "rgba(138,43,226,0.7)",
          ];
          particle.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];

          particle.style.top = `${e.clientY}px`;
          particle.style.left = `${e.clientX}px`;

          document.body.appendChild(particle);

          gsap.to(particle, {
            opacity: 0,
            scale: Math.random() * 2 + 1,
            x: (Math.random() - 0.5) * 20,
            y: (Math.random() - 0.5) * 20,
            duration: 1 + Math.random(),
            onComplete: () => {
              particle.remove();
            },
          });
        });
      }

      // Set up 3D scene transitions
      function setupSceneTransitions() {
        // Map data-scene attributes to scene names
        const sceneMap = {
          kiss: "kiss",
          meals: "meals",
          bed: "bed",
          lifetime: "lifetime",
          "no-more": "noMore",
          "new-exciting": "newExciting",
          "grew-up": "grewUp",
          shatter: "shatter",
          glitter: "glitter",
          beautiful: "beautiful",
          magic: "magic",
        };

        // Set up a ScrollTrigger for each section
        document.querySelectorAll(".section").forEach((section) => {
          const sceneAttr = section.getAttribute("data-scene");
          if (sceneAttr && sceneMap[sceneAttr]) {
            const sceneName = sceneMap[sceneAttr];

            ScrollTrigger.create({
              trigger: section,
              start: "top 50%",
              end: "bottom 50%",
              onEnter: () => switchToScene(sceneName),
              onEnterBack: () => switchToScene(sceneName),
              markers: false,
            });
          }
        });

        // Make sure switchToScene function exists
        if (typeof switchToScene !== "function") {
          console.error(
            "switchToScene function not found, checking if included in scenes.js"
          );
        }

        // Start with the first scene after a delay
        setTimeout(() => {
          try {
            switchToScene("kiss");
            console.log("Switched to initial scene");
          } catch (error) {
            console.error("Error switching to initial scene:", error);
          }
        }, 1000);
      }
    </script>
  </body>
</html>
